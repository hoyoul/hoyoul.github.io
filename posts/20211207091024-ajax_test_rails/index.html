<!DOCTYPE html>
<html>
  <head><title>ajax test [rails6 api server]</title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes" />

<link rel="shortcut icon" href="./img/favicon.ico" type="image/x-icon">
<link rel="icon" href="./img/favicon.ico" type="image/x-icon">    

<link rel="stylesheet" href="/css/main.css">

</head>
  <body><header>
  <a href="/" id="logo">
    <img src="http://braindump.frege2godel.me/img/mylogo.png" alt="holy frege">
    <h3><span>H</span>oly <span>F</span>rege's <span id="note">notes</span></h3>
  </a>
    <small>G.frege를 너무 사랑하는 holy가...</small>  
</header>

<div class="container">
  <div class="page">
    <h1 class="collapsed-title">ajax test [rails6 api server]</h1>    
      <div class="content">
	<a href="http://braindump.frege2godel.me/posts/20211207091024-ajax_test_rails/" alt="ajax test [rails6 api server]" class="permalink"><h1>ajax test [rails6 api server]</h1></a>      
	<h2 id="server처리">server처리</h2>
<ul>
<li>서버에서 json으로 보내는것을 확인해보자. client에서 db자료를 여러형태로 json을 요구할 수 있다. 월별자료, 일별자료, 종류별 자료&hellip;그때마다 json으로 보낼껀데, server에선 여러 url을 만들어서 처리해야 한다. 그래서 이렇게 json만 주고 받게 server를 바꿀수 있는데, 그것을 api server로 받는다. web server는 요청에 의해서 html페이지를 전달 했다면, api서버는 요청에 json을 전달한다. REST API에서는 rest api server를 만들어야 한다. 여튼, 간단히 요청에 의해서 json을 전달하는 기능을 구현해 보자.</li>
</ul>
<h3 id="api-module-controller만들기">api module controller만들기</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>rails g controller api::v1::Statistics (api모듈의 version1의 Statistics controller를 의미)
</span></span></code></pre></div><ul>
<li>api만을 처리할 controller를 만들기 위해서 module 처리를 하기로 한다.</li>
<li>위와 같이 실행하면 controller.rb파일이 api&gt;v1폴더 안에 만들어진다.</li>
<li>이렇게 namespace(폴더형태)를 사용하면, routes나 view도 기존과는 다르게 처리해 줘야 한다.</li>
</ul>
<h4 id="routes-수정">[routes 수정]</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>namespace &#39;apiI&#39; do
</span></span><span style="display:flex;"><span>     namespace &#39;v1&#39; do
</span></span><span style="display:flex;"><span>     get &#39;/realtimedata&#39; =&gt; &#39;statistics#realtimedata&#39;
</span></span><span style="display:flex;"><span>     get &#39;/hourlydata&#39; =&gt; &#39;statistics#hourlydata&#39;
</span></span><span style="display:flex;"><span>     get &#39;/dailydata&#39; =&gt; &#39;statistics#dailydata&#39;
</span></span><span style="display:flex;"><span>     get &#39;/monthlydata&#39; =&gt; &#39;statistics#monthlydata&#39;
</span></span><span style="display:flex;"><span>    end
</span></span><span style="display:flex;"><span>end
</span></span></code></pre></div><h4 id="controller-처리">[controller 처리]</h4>
<ul>
<li>위의  routes를 보면, statistics controller의 realtimedata, hourly data, dailydata, monthly data의 action을 호출한다.</li>
<li>각각의 action에서는 db에서 data를 읽고, json으로 보내면 된다.</li>
<li>별도의 view page는 없다. 이 url의 목적은 json 데이터만 가져가기 위함이다.</li>
<li>ajax로 해당 url에 접속해서 data를 가져갈 뿐이다. 그러면 ajax가 있는 js파일은 어떤 page에 포함되는가?</li>
<li>chart를 그릴려는 page에서 ajax가 포함된 js를 임베딩해서 사용하면 된다.
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"></code></pre></div></li>
</ul>
<h4 id="js의-처리-ajax">[js의 처리-ajax]</h4>
      
      </div>
        
  
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
  

  

  </div>
</div>  

<script src="/js/URI.js" type="text/javascript"></script>
<script src="/js/page.js" type="text/javascript"></script>
</body>
</html>
