<!DOCTYPE html>
<html>
  <head><title>org문서 html로 변환후 website 만들기 </title>


<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes" />

<link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
<link rel="icon" href="./images/favicon.ico" type="image/x-icon">    

<link rel="stylesheet" href="/css/main.css">

</head>
  <body><header>
  <a href="/" id="logo">
    <img src="http://braindump.frege2godel.me/images/mylogo.png" alt="holy frege">
    <h3><span>H</span>oly <span>F</span>rege's <span id="note">notes</span></h3>
  </a>
    <small>G.frege를 너무 사랑하는 holy가...</small>  
</header>

<div class="container">
  <div class="page">
    <h1 class="collapsed-title">org문서 html로 변환후 website 만들기 </h1>    
      <div class="content">
	<a href="http://braindump.frege2godel.me/posts/20211128113210-org_publish/" alt="org문서 html로 변환후 website 만들기 " class="permalink"><h1>org문서 html로 변환후 website 만들기 </h1></a>      
	<h2 id="참조">참조</h2>
<p><a href="https://orgmode.org/worg/org-tutorials/org-publish-html-tutorial.html">https://orgmode.org/worg/org-tutorials/org-publish-html-tutorial.html</a>
<a href="https://systemcrafters.net/publishing-websites-with-org-mode/building-the-site/">https://systemcrafters.net/publishing-websites-with-org-mode/building-the-site/</a>
miller columns ideas belows
double-loop: <a href="https://commonplace.doubleloop.net/20200821142536-how_i_publish_my_wiki_with_org_publish?stack=publish">https://commonplace.doubleloop.net/20200821142536-how_i_publish_my_wiki_with_org_publish?stack=publish</a>
jethro&rsquo;s braindump
<a href="https://braindump.jethro.dev">https://braindump.jethro.dev</a>
<a href="https://blog.jethro.dev/posts/zettelkasten_with_org/">https://blog.jethro.dev/posts/zettelkasten_with_org/</a>
<a href="https://anagora.org/how-i-publish-my-wiki-with-org-publish">https://anagora.org/how-i-publish-my-wiki-with-org-publish</a>
<a href="https://notes.azlen.me/g3tibyfv/">https://notes.azlen.me/g3tibyfv/</a>
<a href="https://notes.andymatuschak.org/About_these_notes">https://notes.andymatuschak.org/About_these_notes</a>
<a href="https://gileschamberlin.wordpress.com/2020/02/25/writing-a-new-org-mode-exporter-back-end/">https://gileschamberlin.wordpress.com/2020/02/25/writing-a-new-org-mode-exporter-back-end/</a></p>
<h2 id="definition">definition</h2>
<ul>
<li>org를 다른형태의 file로 convert하는 것을 publish라고 한다. html, latex, markdown등 여러 형태로 변환이 가능한데, 여기서는 html 변환을 다룬다.</li>
</ul>
<h2 id="publish하는-program작성">publish하는 program작성</h2>
<ul>
<li>org-website: 폴더를 만든다.</li>
<li>org파일을 읽고 이를 html로 변환하는 코드를 lisp으로 짜야 한다. 이 lisp 코드는 source에 위치하는 폴더에 있는 org파일들을 target에 해당하는 폴더로 publish한다. 그리고 org를 읽고, html로 변환하는 코드도 만들어야 한다. 이것을 직접 짤수도 있지만, ox-publish라는 library가 존재한다. 이 library의 특정변수를 설정하거나 특정함수를 사용하는 방식으로 code를 작성한다.</li>
<li>load ox-publish : publish할때 필요한 변수와 code를 사용할수 있는 library를 load한다.
<pre tabindex="0"><code class="language-nil" data-lang="nil">(require &#39;ox-publish)
</code></pre></li>
<li>org-publish-project-alist: html converting시 필요한 설정이라던가, source와 target에 대한 설정을 한다.</li>
</ul>
<!--listend-->
<pre tabindex="0"><code class="language-nil" data-lang="nil">(setq org-publish-project-alist
      (list
       (list &#34;my-org-site&#34;
	     :recursive t
	     :base-directory &#34;./content&#34;
	     :publishing-directory &#34;./public&#34;
	     :publishing-function &#39;org-html-publish-to-html)))

;; Generate the site output
(org-publish-all t)
</code></pre><ul>
<li>recursive: source에 있는 여러파일을 반복적으로 converting할 것인가?에 대한 setting이다.</li>
<li>base-directory: org파일이 있는 source</li>
<li>publishing-directory: org를 html로 convert한 결과를 모아놓는 target</li>
<li>publishing-function: org를 어떤 형식으로 publish할 지를 설정한다.</li>
<li>org-publish-all: org문서를 ox-publish라는 library로 여러가지로 변환할 수 있는데, 각각의 변환을 project라고 하고, org-publish-project-alist에서 각각의 list는 하나의 project를 나타낸다. 이렇게 기술된 project들 모두를 publish하겠다는 뜻이다.</li>
</ul>
<h2 id="html-converting-test">html converting test</h2>
<ul>
<li><a href="">emacs el 테스트</a>에 보면, el script를 실행하는 법이 나와 있다.</li>
<li>program 작성</li>
</ul>
<!--listend-->
<pre tabindex="0"><code class="language-nil" data-lang="nil">(require &#39;ox-publish)

(setq org-publish-project-alist
      (list
       (list &#34;my-org-site&#34;
	     :recursive t
	     :base-directory &#34;./content&#34;
	     :publishing-directory &#34;./public&#34;
	     :publishing-function &#39;org-html-publish-to-html)))
;; Generate the site output
(org-publish-all t)
(message &#34;Build complete!&#34;)
</code></pre><ol>
<li>bash script를 만들어서 실행</li>
<li>여기서 emacs -Q &ndash;script로 실행하는 대신, 아래처럼 build.sh란  bash script을 만들고 실행하자.</li>
</ol>
<!--listend-->
<pre tabindex="0"><code class="language-nil" data-lang="nil">#!/bin/sh
emacs -Q --script build-site.el
</code></pre><h2 id="preview-test">preview test</h2>
<ul>
<li>만들어진 html을 browser로 볼 필요가 있다.</li>
<li>emacs에선 simple-httpd란 library가 있다. 외부의 httpd을 킬수 있다.
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>​- httpd-serve-direcotry: converted된 html은 public폴더에 있다. 이 폴더를 지정한다.
</span></span><span style="display:flex;"><span>​- httpd-start로 서버를 켠다.
</span></span><span style="display:flex;"><span>​- browser에서 localhost:8080/xxx.html로 확인한다.
</span></span></code></pre></div></li>
</ul>
<h2 id="html-improving">html improving</h2>
<p><a id="figure--"></a></p>
<figure><img src="./img/simplehtml.png"
         alt="Figure 1: simple html" width="400px" height="300px"/><figcaption>
            <p><span class="figure-number">Figure 1: </span>simple html</p>
        </figcaption>
</figure>

<ul>
<li>위에 보면 자동으로 만들어지는 html 요소가 있는데, 이부분에 대한 처리를 할 수 있다.</li>
<li>[org-publish-project-alist에서 변수처리]
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>:with-author nil           ;; Don&#39;t include author name
</span></span><span style="display:flex;"><span>:with-creator t            ;; Include Emacs and Org versions in footer
</span></span><span style="display:flex;"><span>:with-toc t                ;; Include a table of contents
</span></span><span style="display:flex;"><span>:section-numbers nil       ;; Don&#39;t include section numbers
</span></span><span style="display:flex;"><span>:time-stamp-file nil
</span></span></code></pre></div></li>
<li>[개별적 변수 처리]
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>(setq org-html-validation-link nil)
</span></span></code></pre></div></li>
</ul>
<h2 id="css-처리">css 처리</h2>
<pre tabindex="0"><code class="language-nil" data-lang="nil">;; Customize the HTML output
(setq org-html-validation-link nil            ;; Don&#39;t show validation link
      org-html-head-include-scripts nil       ;; Use our own scripts
      org-html-head-include-default-style nil ;; Use our own styles
      org-html-head &#34;&lt;link rel=\&#34;stylesheet\&#34; href=\&#34;https://cdn.simplecss.org/simple.min.css\&#34; /&gt;&#34;)
</code></pre><ul>
<li>위의 코드를 추가한다. css는 simple.css라는 무난한 css를 추가했다.</li>
</ul>
<h2 id="css-test-결과">css test 결과</h2>
<ul>
<li>build-site.el program을 다음과 같이 한다.
<pre tabindex="0"><code class="language-nil" data-lang="nil">;; Customize the HTML output
(setq org-html-validation-link nil            ;; Don&#39;t show validation link
      org-html-head-include-scripts nil       ;; Use our own scripts
      org-html-head-include-default-style nil ;; Use our own styles
      org-html-head &#34;&lt;link rel=\&#34;stylesheet\&#34; href=\&#34;https://cdn.simplecss.org/simple.min.css\&#34; /&gt;&#34;)

;; Define the publishing project
(setq org-publish-project-alist
      (list
       (list &#34;org-site:main&#34;
	     :recursive t
	     :base-directory &#34;./content&#34;
	     :publishing-function &#39;org-html-publish-to-html
	     :publishing-directory &#34;./public&#34;
	     :with-author nil           ;; Don&#39;t include author name
	     :with-creator t            ;; Include Emacs and Org versions in footer
	     :with-toc t                ;; Include a table of contents
	     :section-numbers nil       ;; Don&#39;t include section numbers
	     :time-stamp-file nil)))    ;; Don&#39;t include time stamp in file

;; Generate the site output
(org-publish-all t)

(message &#34;Build complete!&#34;)
</code></pre></li>
<li>build.sh를 실행킨다.</li>
<li>browser에서 <a href="http://localhost:8080/xxx.html%EB%A1%9C">http://localhost:8080/xxx.html%EB%A1%9C</a> 확인한다.</li>
</ul>
<p><a id="figure--"></a></p>
<figure><img src="./img/before_css.png"
         alt="Figure 2: before" width="800px" height="400px"/><figcaption>
            <p><span class="figure-number">Figure 2: </span>before</p>
        </figcaption>
</figure>

<p><a id="figure--"></a></p>
<figure><img src="./img/after_css.png"
         alt="Figure 3: after" width="800px" height="400px"/><figcaption>
            <p><span class="figure-number">Figure 3: </span>after</p>
        </figcaption>
</figure>

<h2 id="code-block-문제">code block 문제</h2>
<ul>
<li>code block의 경우, html converting 시에 다음과 같은 에러가 발생한다.</li>
</ul>
<p><a id="figure--"></a></p>
<figure><img src="./img/codeblock.png" width="400px" height="300px"/>
</figure>

<ul>
<li>[ htmlize 해결법 ]
아래 코드를 build-site.el에 추가한다.
<pre tabindex="0"><code class="language-nil" data-lang="nil">;; Set the package installation directory so that packages aren&#39;t stored in the
;; ~/.emacs.d/elpa path.
(require &#39;package)
(setq package-user-dir (expand-file-name &#34;./.packages&#34;))
(setq package-archives &#39;((&#34;melpa&#34; . &#34;https://melpa.org/packages/&#34;)
			 (&#34;elpa&#34; . &#34;https://elpa.gnu.org/packages/&#34;)))

;; Initialize the package system
(package-initialize)
(unless package-archive-contents
  (package-refresh-contents))

;; Install dependencies
(package-install &#39;htmlize)
</code></pre></li>
<li>[ 결과 ]</li>
</ul>
<p><a id="figure--"></a></p>
<figure><img src="./img/codeblock2.png"
         alt="Figure 4: 결과" width="800px" height="400px"/><figcaption>
            <p><span class="figure-number">Figure 4: </span>결과</p>
        </figcaption>
</figure>

<h2 id="link-문제">link 문제</h2>
<ul>
<li>다른 org파일을 link로 걸었을때 그 파일도 html로 보여지는가?</li>
<li>같은 폴더에 있다면, link걸린 org도 html로 변경되어 보여진다. 다른 폴더에 있으면 동작하지 않는다.</li>
</ul>
<h2 id="github-web-site-만들기">github web site 만들기</h2>
<ul>
<li><a href="mailto:research.jeju@gmail.com">research.jeju@gmail.com</a>, jeju!123 라는 email로 <a href="https://github.com/">github</a>을 만들었다.</li>
<li>Jeju-research.github.io라는 이름의 repository를 만든다. 이것은 webpage를 publish하기 위한 규약이다.</li>
<li>org-website에 내 source들이 있다. 이것은 위에서 만든 repo에 연결하기 위해선, git remote add를 사용한다.</li>
<li>git remote add origin <a href="https://github.com/jeju-research/jeju-research.github.io.git">https://github.com/jeju-research/jeju-research.github.io.git</a></li>
<li>만일 orgin이 있다면, git remote remove origin을 사용한다.</li>
<li>이제, git push origin main (문제 발생: <a href="">github 사용법</a> 으로 push한다.</li>
</ul>
<p><a id="figure--"></a></p>
<figure><img src="./img/githuberror1.png" width="400px" height="300px"/>
</figure>

<ul>
<li>
<p>push할 때 위와 같은 에러가 발생한다. multiple github accounts를 가지고 있는 경우 이런 문제가 종종 발 생한다.  일반적으로 원격 repo에 접속할 때, ssh key가 필요하다. 지금 push할려고 하는 것은 PnC jeju의 ssh key를 가지고 접속할려고 한다는 뜻이다. 이렇게 된 이유는 ssh-agent에 jeju key가 등록되어 있지 않기 때문에 default인 pnc key를 가지고 접속한 것이다.</p>
</li>
<li>
<p>[해결법] .ssh폴더에 가서 ssh-add ./id_rsa_jeju 키를 등록하고 다시 push한다.</p>
</li>
</ul>
<p><a id="figure--"></a></p>
<figure><img src="./img/gitcredentials.png" width="200px" height="100px"/>
</figure>

<h2 id="github-action-사용법">github action 사용법</h2>
<ul>
<li>github action은 local에서 사용하는 계산을 github단에서 할수 있게 해준다.</li>
<li>예를 들면, org파일을 읽고, html파일로 변경하는 작업도 한다.</li>
<li>github에 org파일만 올려놓으면, github action에서 html로 변경하는 작업을 해준다고 보면 된다.</li>
<li>publish.yml이란 파일을 만들고, 해당 파일을 .github/workflows/publish.yml로 이동한다.
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>name: Publish to GitHub Pages
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>on:
</span></span><span style="display:flex;"><span>  push:
</span></span><span style="display:flex;"><span>    branches:
</span></span><span style="display:flex;"><span>​      - master
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>jobs:
</span></span><span style="display:flex;"><span>  publish:
</span></span><span style="display:flex;"><span>    runs-on: ubuntu-latest
</span></span><span style="display:flex;"><span>    steps:
</span></span><span style="display:flex;"><span>​      - name: Check out
</span></span><span style="display:flex;"><span>        uses: actions/checkout@v1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - name: Install Emacs
</span></span><span style="display:flex;"><span>        run: sudo apt install emacs-nox --yes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - name: Build the site
</span></span><span style="display:flex;"><span>        run: ./build.sh
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      - name: Publish generated content to GitHub Pages
</span></span><span style="display:flex;"><span>        uses: JamesIves/github-pages-deploy-action@4.1.4
</span></span><span style="display:flex;"><span>        with:
</span></span><span style="display:flex;"><span>          branch: gh-pages
</span></span><span style="display:flex;"><span>          folder: public
</span></span></code></pre></div></li>
<li>위에 보면, emacs nox(no x window)를 github에 설치한후 build.sh를 실행한다. 그리고 pub</li>
</ul>
<h2 id="image-path문제">image path문제</h2>
<ul>
<li>contents폴더는 org파일만 집어넣어야 한다. 왜냐면, recursive하게 compile하기 때문이다.</li>
<li>org문서에서 image를 상대경로로 접근할 때, 문제가 생긴다. org문서는 html로 변경되어 gh-pages라는 branch로 이동되는데, 거기에는 image가 없다. 따라서 image폴더를 넣어주거나, 아니면 image path를 절대 경로로 해줘야 할듯 하다.</li>
<li>image의 절대경로
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>https://raw.githubusercontent.com/jeju-research/jeju-research.github.io/main/contents/img/ship2.png
</span></span></code></pre></div></li>
<li>사용법</li>
</ul>
<p>snippets을 만들었다. gimage라고 만들었다.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>#+CAPTION:
</span></span><span style="display:flex;"><span>#+NAME:
</span></span><span style="display:flex;"><span>#+attr_html: :width 400px :height 300px
</span></span><span style="display:flex;"><span>#+attr_latex: :width 100px
</span></span><span style="display:flex;"><span>[[https://raw.githubusercontent.com/jeju-research/jeju-research.github.io/main/img/ship2.png]]
</span></span></code></pre></div><p>여기서 경로는 다음과 같다. main branch 아래 img폴더의 img</p>
      
      </div>
        
  
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
    
     
  

  

  </div>
</div>  
<script src="/js/page.js"></script>
</body>
</html>
